// ==================== GLOBAL VARIABLES (ongeza hii) ====================
let currentRoomId = ""; // <-- ONGEZA HII
let currentRoomListener = null; // <-- ONGEZA HII

// ==================== MESSAGING (badilisha nzima) ====================
function listenForMessages(roomId) {
    // Ondoa listener ya zamani ikiwa ipo
    if (currentRoomListener) {
        db.ref('messages/' + currentRoomId).off('child_added', currentRoomListener);
    }

    chatFlow.innerHTML = ''; // Safisha chat

    // Weka listener mpya
    currentRoomId = roomId;
    const messagesRef = db.ref('messages/' + roomId);
    
    currentRoomListener = messagesRef.orderByChild('timestamp').on('child_added', (snap) => {
        const msg = snap.val();
        renderMessage(msg, snap.key);
    });
}

// ==================== ENTER KEY TO SEND (ongeza chini ya sendMsg) ====================
document.addEventListener('DOMContentLoaded', function() {
    const msgInput = document.getElementById('msg-input');
    if (msgInput) {
        msgInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMsg();
            }
        });
    }
});
